version: '3.8'

# Rabit Example - Burrows and Warren
# 
# This Docker Compose file hosts three example burrows and a warren (registry).
# Each burrow is a simple static file server hosting content with a .burrow.json manifest.
#
# Usage:
#   docker compose up -d
#
# Access:
#   Warren:      http://localhost:8080/.warren.json
#   Docs Burrow: http://localhost:8081/.burrow.json
#   API Burrow:  http://localhost:8082/.burrow.json
#   Blog Burrow: http://localhost:8083/.burrow.json

services:
  # Warren (Registry) - indexes all burrows
  warren:
    image: nginx:alpine
    container_name: warren
    ports:
      - "8080:80"
    volumes:
      - ../:/usr/share/nginx/html:ro
      - ./nginx-cors.conf:/etc/nginx/conf.d/cors.conf:ro
    networks:
      - rabit-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/.warren.json"]
      interval: 10s
      timeout: 5s
      retries: 3

  # Documentation Burrow
  docs-burrow:
    image: nginx:alpine
    container_name: docs-burrow
    ports:
      - "8081:80"
    volumes:
      - ../burrows/docs-burrow:/usr/share/nginx/html:ro
      - ./nginx-cors.conf:/etc/nginx/conf.d/cors.conf:ro
    networks:
      - rabit-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/.burrow.json"]
      interval: 10s
      timeout: 5s
      retries: 3

  # API Reference Burrow
  api-burrow:
    image: nginx:alpine
    container_name: api-burrow
    ports:
      - "8082:80"
    volumes:
      - ../burrows/api-burrow:/usr/share/nginx/html:ro
      - ./nginx-cors.conf:/etc/nginx/conf.d/cors.conf:ro
    networks:
      - rabit-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/.burrow.json"]
      interval: 10s
      timeout: 5s
      retries: 3

  # Engineering Blog Burrow
  blog-burrow:
    image: nginx:alpine
    container_name: blog-burrow
    ports:
      - "8083:80"
    volumes:
      - ../burrows/blog-burrow:/usr/share/nginx/html:ro
      - ./nginx-cors.conf:/etc/nginx/conf.d/cors.conf:ro
    networks:
      - rabit-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/.burrow.json"]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  rabit-network:
    driver: bridge
